syntax = "proto3";
import "google/protobuf/timestamp.proto";

option java_package = "com.google.pubsub.flic.common";
option java_outer_classname = "LoadtestProto";

service Loadtest {
  rpc Start(StartRequest) returns (StartResponse);
  rpc Check(CheckRequest) returns (CheckResponse);
}

message StartRequest {
  // The time at which the load test should start.
  google.protobuf.Timestamp start_time = 1;

  // The time at which the load test should be stopped.
  google.protobuf.Timestamp stop_time = 2;

  // The GCP project. This must be set even for Kafka, as we use it to export metrics to Stackdriver.
  string project = 3;

  // The Pub/Sub or Kafka topic name.
  string topic = 4;

  // The number of requests that can be made, each second, per client.
  int32 request_rate = 5;

  // The size of each user message to publish
  int32 message_size = 6;

  // The number of user messages of size message_size to batch together in each publish
  int32 batch_size = 7;

  // The maximum concurrent requests, per client.
  int32 max_concurrent_requests = 8;

  oneof options {
   PubsubOptions pubsub_options = 9;
   KafkaOptions kafka_options = 10;
  }
}

message StartResponse {
}

message PubsubOptions {
  // The Cloud Pub/Sub subscription name
  string subscription = 1;

  // The maximum number of messages to pull which each request.
  int32 max_messages_per_pull = 2;
}

message KafkaOptions {
  // The network address of the Kafka broker.
  string broker = 1;

  // The length of time to poll for.
  int32 poll_length = 2;
}

message CheckRequest {
}

message CheckResponse {
  repeated int64 bucket_values = 1;
  bool is_finished = 2;
}